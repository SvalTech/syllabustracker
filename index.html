<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JEE Syllabus Tracker | SvalTech</title>

    <meta name="description" content="A modern, interactive dashboard to track your complete JEE 2026 syllabus progress. Master your prep with SvalTech.">
    <meta name="keywords" content="JEE, JEE 2026, JEE Syllabus, JEE Tracker, Syllabus Tracker, IIT JEE, JEE Main, SvalTech, JEE 2027, JEE 2028">
    <link rel="canonical" href="https://sval.tech/syllabustracker/">
    
    <meta property="og:title" content="JEE Syllabus Tracker | SvalTech">
    <meta property="og:description" content="Track your JEE 2026 syllabus progress with a modern, interactive dashboard.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://placehold.co/1200x630/6366f1/white?text=JEE+Mastery">
    <meta property="og:site_name" content="SvalTech">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¯</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        bg: '#09090b', // Zinc 950
                        card: '#18181b', // Zinc 900
                        'card-hover': '#27272a', // Zinc 800
                        border: '#27272a', // Zinc 800
                        primary: '#6366f1', // Indigo 500
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        blob: "blob 10s infinite",
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" },
                        },
                    }
                }
            }
        }
    </script>

    <style>
        /* --- Custom Scrollbar (Thinner) --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

        /* --- Global Styles --- */
        body {
            background-color: #09090b;
            color: #a1a1aa;
            -webkit-font-smoothing: antialiased;
            background-image: radial-gradient(circle at 50% 0%, #18181b 0%, #09090b 70%);
        }

        /* --- Glassmorphism Utilities --- */
        .glass-panel {
            background: rgba(24, 24, 27, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: rgba(39, 39, 42, 0.4); 
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(39, 39, 42, 0.6);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.1);
        }

        /* --- Accordion Transitions (CSS Grid Trick) --- */
        .accordion-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
        }
        .accordion-wrapper.open {
            grid-template-rows: 1fr;
        }
        .accordion-inner {
            min-height: 0;
        }

        /* --- Arrow Rotation --- */
        .arrow-icon {
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .group-branch.expanded .arrow-icon,
        .subject-card.expanded .arrow-icon {
            transform: rotate(90deg);
        }

        /* --- Inline Status Menu Animation --- */
        .status-menu-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0;
            overflow: hidden;
        }
        .status-menu-wrapper.open {
            grid-template-rows: 1fr;
            opacity: 1;
            margin-top: 0.25rem;
        }

        /* --- Toggle Switch --- */
        .view-toggle {
            position: relative;
            background: #18181b;
            border: 1px solid #27272a;
        }
        .view-toggle-slider {
            position: absolute;
            top: 4px; left: 4px; bottom: 4px;
            width: calc(50% - 4px);
            background: #27272a;
            border: 1px solid #3f3f46;
            border-radius: 6px;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 0;
        }
        .view-toggle[data-mode="flat"] .view-toggle-slider {
            transform: translateX(100%);
        }

        /* --- Toast Notification --- */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
            background: #18181b;
            border: 1px solid #27272a;
            color: #fff;
            padding: 12px 24px;
            border-radius: 99px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 100;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: none;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* --- Banner Animations --- */
        #zenith-banner {
            transition: opacity 0.4s ease, transform 0.4s ease, max-height 0.4s ease, margin 0.4s ease;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transform: translateY(-10px);
        }
        #zenith-banner.show {
            max-height: 200px;
            opacity: 1;
            transform: translateY(0);
            margin-bottom: 2rem;
        }

        /* --- Highlighting --- */
        .highlight {
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            padding: 0 2px;
            border-radius: 2px;
        }
        
        /* --- Velocity Transitions --- */
        #velocity-content {
            transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), margin-top 0.3s ease;
        }
        #velocity-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
        }
        #velocity-chevron {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #velocity-chevron.collapsed {
            transform: rotate(-90deg);
        }
        
        /* --- Blob Animation Delay --- */
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }
    </style>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TCK0S6VC58"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TCK0S6VC58');
    </script>
</head>
<body class="antialiased selection:bg-indigo-500/30 selection:text-indigo-200 relative">

    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-1/2 transform -translate-x-1/2 w-[500px] h-[500px] bg-indigo-500/10 rounded-full blur-[120px] animate-blob mix-blend-screen"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-[600px] h-[600px] bg-purple-500/10 rounded-full blur-[120px] animate-blob animation-delay-2000 mix-blend-screen"></div>
        <div class="absolute bottom-[20%] right-[-10%] w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[120px] animate-blob animation-delay-4000 mix-blend-screen"></div>
    </div>

    <div class="container mx-auto max-w-[96%] 2xl:max-w-[1800px] px-3 sm:px-6 lg:px-8 py-4 sm:py-6">

        <header class="text-center mb-6 sm:mb-8 relative animate-fade-in-up">
            <div class="inline-block relative">
                <h1 class="text-3xl sm:text-5xl font-black tracking-tight text-white mb-2 relative z-10">
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-indigo-400 animate-pulse-slow">JEE Syllabus</span> Tracker
                </h1>
                <div class="absolute -inset-x-10 -inset-y-4 bg-indigo-600/20 blur-[60px] rounded-[100%] z-0 pointer-events-none"></div>
            </div>
            <p class="text-xs sm:text-sm font-medium text-zinc-500 mt-1 tracking-wide">
                Powered by <a href="https://sval.tech" class="text-zinc-300 hover:text-white transition-colors border-b border-dashed border-zinc-600 hover:border-white">sval.tech</a>
            </p>
        </header>

        <div id="zenith-banner" class="glass-panel rounded-xl border-indigo-500/20 relative group max-w-7xl mx-auto">
            <div class="absolute inset-0 bg-gradient-to-r from-indigo-600/10 to-transparent opacity-50 transition-opacity group-hover:opacity-70"></div>
            <div class="p-3 sm:p-4 relative z-10 flex flex-col sm:flex-row items-center justify-between gap-3">
                <div class="flex items-center gap-3 text-center sm:text-left">
                    <div class="w-8 h-8 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 text-indigo-400 shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m8 3 4 8 5-5 5 15H2L8 3z"></path></svg>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white">Discover Zenith</h3>
                        <p class="text-xs text-zinc-400 max-w-lg">The ultimate exam workspace. Visualize victory with advanced tracking and mock analysis.</p>
                    </div>
                </div>
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <a href="https://sval.tech/zenith/" target="_blank" class="flex-1 sm:flex-none text-center px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-semibold rounded-lg shadow-lg shadow-indigo-500/20 transition-all transform hover:-translate-y-0.5">
                        Launch App
                    </a>
                    <button id="close-banner-btn" class="p-2 text-zinc-500 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="flex flex-col xl:flex-row gap-5 items-start relative">
            
            <aside id="overall-stats-container" class="w-full xl:w-80 xl:sticky xl:top-6 z-30 transition-all duration-300 flex-shrink-0">
                <div class="glass-panel rounded-xl p-4 sm:p-5 shadow-2xl shadow-black/50">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-base font-bold text-white">Overall Status</h2>
                        <div class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)] animate-pulse"></div>
                    </div>

                    <div id="overall-progress-data" class="space-y-4">
                        <div class="animate-pulse space-y-4">
                            <div class="h-8 bg-zinc-800 rounded w-1/3 mx-auto"></div>
                            <div class="h-2 bg-zinc-800 rounded-full w-full"></div>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-zinc-800">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-[10px] font-semibold text-zinc-400 uppercase tracking-wider">Group By</label>
                        </div>
                        <div class="view-toggle flex rounded-lg p-1 cursor-pointer" data-mode="priority">
                            <div class="view-toggle-slider"></div>
                            <div id="filter-priority" data-filter="priority" class="flex-1 text-center py-1.5 text-xs font-medium relative z-10 transition-colors text-white">Priority</div>
                            <div id="filter-flat" data-filter="flat" class="flex-1 text-center py-1.5 text-xs font-medium relative z-10 transition-colors text-zinc-500">Unit</div>
                        </div>
                    </div>

                    <div id="velocity-container" class="mt-6 pt-4 border-t border-zinc-800 hidden">
                        <div id="velocity-toggle-btn" class="flex items-center justify-between cursor-pointer group select-none">
                            <h3 class="text-[10px] font-semibold text-zinc-400 uppercase tracking-wider flex items-center gap-2 group-hover:text-zinc-300 transition-colors">
                                <svg class="w-3 h-3 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                Completion Estimator
                            </h3>
                            <svg id="velocity-chevron" class="w-3 h-3 text-zinc-600 group-hover:text-zinc-400 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        
                        <div id="velocity-content" class="overflow-hidden max-h-40 opacity-100">
                            <div class="bg-zinc-900/50 rounded-lg p-3 border border-zinc-800 mt-3">
                                <div class="flex justify-between items-end mb-2">
                                    <span class="text-xs text-zinc-400">Chapters Left</span>
                                    <span class="text-sm font-bold text-white" id="vel-chapters-left">--</span>
                                </div>
                                <div class="flex justify-between items-end mb-2">
                                    <span class="text-xs text-zinc-400">Current Pace</span>
                                    <span class="text-xs font-mono text-indigo-300" id="vel-pace">-- ch/day</span>
                                </div>
                                <div class="h-px bg-zinc-800 my-2"></div>
                                <div class="text-center">
                                    <span class="text-[10px] text-zinc-500 uppercase tracking-wide">Est. Completion</span>
                                    <div class="text-sm font-bold text-white mt-0.5" id="vel-end-date">Insufficient Data</div>
                                    <div class="text-[10px] text-zinc-600 mt-1" id="vel-subtext">Keep updating to see data</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 space-y-2">
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-3.5 w-3.5 text-zinc-500 group-focus-within:text-indigo-400 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="text" id="syllabus-search" placeholder="Search chapters..." class="w-full pl-9 pr-3 py-3 bg-black/20 border border-zinc-700 rounded-lg text-sm text-zinc-200 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all placeholder-zinc-600" />
                        </div>

                        <button id="share-progress-main-btn" class="w-full py-3 bg-zinc-800 hover:bg-zinc-700 text-white font-medium rounded-lg transition-all flex items-center justify-center text-sm border border-zinc-700 hover:border-zinc-600 group">
                            <svg class="w-4 h-4 mr-2 text-zinc-400 group-hover:text-indigo-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg>
                            Share Progress
                        </button>

                        <button id="reset-data-btn" class="w-full py-3 text-red-400 hover:text-red-300 hover:bg-red-500/10 font-medium rounded-lg transition-all flex items-center justify-center text-xs">
                            Reset Data
                        </button>
                    </div>
                </div>
            </aside>

            <main id="syllabus-container" class="flex-1 grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4 w-full pb-20">
                </main>

        </div>

        <footer class="mt-16 border-t border-zinc-800 pt-8 pb-6 text-center">
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                <div class="px-3 py-1.5 rounded-full bg-zinc-900 border border-zinc-800 text-[10px] text-zinc-400 uppercase tracking-wide">
                    Priority Source: <span class="text-indigo-400 font-bold">MathonGo (2026)</span>
                </div>
                <a href="https://cdnbbsr.s3waas.gov.in/s3f8e59f4b2fe7c5705bf878bbd494ccdf/uploads/2025/10/202510311323551056.pdf" target="_blank" class="px-3 py-1.5 rounded-full bg-zinc-900 border border-zinc-800 text-[10px] text-zinc-400 uppercase tracking-wide hover:border-indigo-500/50 hover:text-indigo-400 transition-colors">
                    Official Syllabus PDF
                </a>
                <a href="https://discord.gg/c8xHpTfM" target="_blank" class="px-3 py-1.5 rounded-full bg-[#5865F2]/10 border border-[#5865F2]/20 text-[10px] text-[#5865F2] uppercase tracking-wide hover:bg-[#5865F2] hover:text-white transition-all flex items-center gap-2">
                    <svg class="w-3 h-3 fill-current" viewBox="0 0 127.14 96.36">
                        <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.11,77.11,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22c1.24-23.28-3.28-47.54-18.9-72.15ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </svg>
                    Feedback / Discord
                </a>
            </div>
            <p class="text-zinc-600 text-xs">
                Designed & Built by <a href="https://github.com/svalordev" target="_blank" class="text-zinc-400 hover:text-white transition-colors underline decoration-dotted underline-offset-4">Shaurya Pratap Singh</a>
            </p>

        </footer>

    </div>

    <div class="fixed bottom-6 right-6 z-50">
        <div id="fab-menu" class="absolute bottom-full right-0 mb-3 w-44 py-2 rounded-xl bg-zinc-900 border border-zinc-800 shadow-2xl transition-all duration-300 origin-bottom-right opacity-0 invisible scale-95">
            <a href="https://sval.tech/studylocus/" target="_blank" class="flex items-center gap-3 px-4 py-3 text-sm text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"/><path d="M3 9h18"/></svg>
                StudyLocus
            </a>
            <div class="h-px bg-zinc-800 my-1"></div>
            <a href="https://sval.tech/zenith/" target="_blank" class="flex items-center gap-3 px-4 py-3 text-sm text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m8 3 4 8 5-5 5 15H2L8 3z"></path></svg>
                Zenith App
            </a>
        </div>
        <button id="fab-btn" class="w-12 h-12 bg-indigo-600 hover:bg-indigo-500 rounded-full shadow-lg shadow-indigo-600/30 flex items-center justify-center text-white transition-all transform active:scale-95">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
    </div>

    <div id="reset-modal" class="fixed inset-0 z-[60] hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6">
            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 shadow-2xl">
                <div class="w-12 h-12 rounded-full bg-red-500/10 flex items-center justify-center text-red-500 mb-4 mx-auto">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                </div>
                <h3 class="text-xl font-bold text-white text-center mb-2">Clear all progress?</h3>
                <p class="text-zinc-400 text-center text-sm mb-6">This action is irreversible. All your tracked chapters and status updates will be permanently removed from this device.</p>
                <div class="grid grid-cols-2 gap-3">
                    <button id="cancel-reset-btn" class="px-4 py-3 rounded-lg bg-zinc-800 text-zinc-300 font-medium hover:bg-zinc-700 transition-colors">Cancel</button>
                    <button id="confirm-reset-btn" class="px-4 py-3 rounded-lg bg-red-600 text-white font-medium hover:bg-red-500 transition-colors shadow-lg shadow-red-600/20">Yes, Clear All</button>
                </div>
            </div>
        </div>
    </div>

    <div id="share-modal" class="fixed inset-0 z-[60] hidden flex opacity-0 transition-opacity duration-300 items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" id="close-share-overlay"></div>
        
        <div class="relative w-full max-w-sm transform transition-all scale-95 opacity-0" id="share-modal-content">
            <button id="close-share-modal-btn" class="absolute -top-12 right-0 p-4 text-zinc-400 hover:text-white transition-colors">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>

            <div id="share-card" class="bg-zinc-950 border border-zinc-800 rounded-2xl overflow-hidden shadow-2xl relative">
                <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-600/20 blur-[80px] rounded-full pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 w-48 h-48 bg-purple-600/10 blur-[60px] rounded-full pointer-events-none"></div>
                
                <div class="p-8 relative z-10 flex flex-col items-center text-center">
                    <div class="inline-block mb-2">
                         <span class="text-[10px] font-bold tracking-[0.2em] text-indigo-400 uppercase">2026 JEE Tracker</span>
                    </div>
                    <h2 class="text-3xl font-black text-white mb-8 tracking-tight">MY PROGRESS</h2>

                    <div class="relative w-40 h-40 flex items-center justify-center mb-8">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="80" cy="80" r="75" stroke="#27272a" stroke-width="8" fill="none" />
                            <circle id="share-ring-physics" cx="80" cy="80" r="75" class="text-indigo-500" stroke="currentColor" stroke-width="8" fill="none" stroke-linecap="round" />
                            
                            <circle cx="80" cy="80" r="60" stroke="#27272a" stroke-width="8" fill="none" />
                            <circle id="share-ring-chemistry" cx="80" cy="80" r="60" class="text-emerald-500" stroke="currentColor" stroke-width="8" fill="none" stroke-linecap="round" />
                            
                            <circle cx="80" cy="80" r="45" stroke="#27272a" stroke-width="8" fill="none" />
                            <circle id="share-ring-maths" cx="80" cy="80" r="45" class="text-amber-500" stroke="currentColor" stroke-width="8" fill="none" stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="share-card-overall-percent" class="text-3xl font-black text-white">0%</span>
                            <span class="text-[10px] uppercase tracking-wider text-zinc-500 font-semibold mt-1">Done</span>
                        </div>
                    </div>

                    <div class="w-full space-y-4 mb-8">
                        <div class="group">
                            <div class="flex justify-between text-xs font-semibold mb-1.5">
                                <span class="text-zinc-400 group-hover:text-indigo-300 transition-colors">PHYSICS</span>
                                <span id="share-card-physics-percent" class="text-white">0%</span>
                            </div>
                            <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                                <div id="share-card-physics-bar" class="h-full bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)] rounded-full w-0 transition-all duration-700"></div>
                            </div>
                        </div>
                        <div class="group">
                            <div class="flex justify-between text-xs font-semibold mb-1.5">
                                <span class="text-zinc-400 group-hover:text-emerald-300 transition-colors">CHEMISTRY</span>
                                <span id="share-card-chemistry-percent" class="text-white">0%</span>
                            </div>
                            <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                                <div id="share-card-chemistry-bar" class="h-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)] rounded-full w-0 transition-all duration-700 delay-100"></div>
                            </div>
                        </div>
                        <div class="group">
                            <div class="flex justify-between text-xs font-semibold mb-1.5">
                                <span class="text-zinc-400 group-hover:text-amber-300 transition-colors">MATHEMATICS</span>
                                <span id="share-card-mathematics-percent" class="text-white">0%</span>
                            </div>
                            <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                                <div id="share-card-mathematics-bar" class="h-full bg-amber-500 shadow-[0_0_10px_rgba(245,158,11,0.5)] rounded-full w-0 transition-all duration-700 delay-200"></div>
                            </div>
                        </div>
                    </div>

                    <div class="w-full pt-6 border-t border-zinc-800/50 flex justify-between items-end">
                        <div class="text-left">
                            <div class="text-[15px] text-zinc-500 font-mono" id="share-card-date">OCT 24, 2025</div>
                            <div class="text-m text-zinc-400 font-bold mt-0.5">sval.tech/syllabustracker</div>
                        </div>
                        <div class="w-8 h-8 rounded bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold shadow-lg">
                            ðŸŽ¯
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="text-center text-zinc-500 text-xs mt-4">Take a screenshot to share!</p>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTS & CONFIG ---
            const STORAGE_KEY = 'jeeSyllabusProgress_v3_premium';
            const OLD_STORAGE_KEY = 'jeeSyllabusProgress_v2_mathongo'; 
            const VIEW_KEY = 'jeeSyllabusView_v3';
            const VIEW_STATE_KEY = 'jeeSyllabusViewState_v3'; 
            const BANNER_KEY = 'zenithBanner_v2';
            const STATS_INIT_KEY = 'jeeSyllabusStatsInit_v1'; 
            const VELOCITY_STATE_KEY = 'jeeSyllabusVelocityVisible_v1'; 
            
            const STATUS_CONFIG = {
                'not-started': { 
                    label: 'Not Started', 
                    weight: 0, 
                    color: 'text-zinc-500', 
                    bg: 'bg-zinc-800', 
                    border: 'border-zinc-700',
                    dot: 'bg-zinc-600'
                },
                'in-progress': { 
                    label: 'In Progress', 
                    weight: 0.5, 
                    color: 'text-amber-400', 
                    bg: 'bg-amber-500/10', 
                    border: 'border-amber-500/20',
                    dot: 'bg-amber-500'
                },
                'completed': { 
                    label: 'Completed', 
                    weight: 1, 
                    color: 'text-emerald-400', 
                    bg: 'bg-emerald-500/10', 
                    border: 'border-emerald-500/20',
                    dot: 'bg-emerald-500'
                },
                'mastered': { 
                    label: 'Mastered', 
                    weight: 1, 
                    color: 'text-indigo-400', 
                    bg: 'bg-indigo-500/10', 
                    border: 'border-indigo-500/20',
                    dot: 'bg-indigo-500'
                }
            };

            // --- DATA (SYLLABUS) ---
            const SYLLABUS_DATA = [
                { 
                    subject: "Physics",
                    units: [
                        { unitName: "Mechanics I", chapters: [ { id: "PHY_B_11", name: "Motion In One Dimension", priority: 'B' }, { id: "PHY_D_01", name: "Motion In Two Dimensions", priority: 'D' }, { id: "PHY_B_10", name: "Laws of Motion", priority: 'B' }, { id: "PHY_B_07", name: "Work Power Energy", priority: 'B' }, { id: "PHY_D_05", name: "Center of Mass Momentum", priority: 'D' }, { id: "PHY_B_03", name: "Rotational Motion", priority: 'B' } ]},
                        { unitName: "Mechanics II & Waves", chapters: [ { id: "PHY_B_04", name: "Gravitation", priority: 'B' }, { id: "PHY_D_02", name: "Mechanical Properties of Solids", priority: 'D' }, { id: "PHY_B_05", name: "Mechanical Properties of Fluids", priority: 'B' }, { id: "PHY_C_06", name: "Oscillations", priority: 'C' }, { id: "PHY_D_03", name: "Waves and Sound", priority: 'D' } ]},
                        { unitName: "Thermodynamics & KTG", chapters: [ { id: "PHY_D_06", name: "Thermal Properties of Matter", priority: 'D' }, { id: "PHY_A_05", name: "Thermodynamics", priority: 'A' }, { id: "PHY_C_05", name: "Kinetic Theory of Gases", priority: 'C' } ]},
                        { unitName: "Electricity & Magnetism", chapters: [ { id: "PHY_A_02", name: "Electrostatics", priority: 'A' }, { id: "PHY_C_02", name: "Capacitance", priority: 'C' }, { id: "PHY_A_01", name: "Current Electricity", priority: 'A' }, { id: "PHY_A_04", name: "Magnetic Effects of Current", priority: 'A' }, { id: "PHY_D_07", name: "Magnetic Properties of Matter", priority: 'D' }, { id: "PHY_C_03", name: "Electromagnetic Induction", priority: 'C' }, { id: "PHY_C_01", name: "Alternating Current", priority: 'C' }, { id: "PHY_C_07", name: "Electromagnetic Waves", priority: 'C' } ]},
                        { unitName: "Optics & Modern Physics", chapters: [ { id: "PHY_A_03", name: "Ray Optics", priority: 'A' }, { id: "PHY_B_09", name: "Wave Optics", priority: 'B' }, { id: "PHY_A_06", name: "Dual Nature of Matter", priority: 'A' }, { id: "PHY_A_07", name: "Atomic Physics", priority: 'A' }, { id: "PHY_C_04", name: "Nuclear Physics", priority: 'C' }, { id: "PHY_B_06", name: "Semiconductors", priority: 'B' } ]},
                        { unitName: "Units & Experimental", chapters: [ { id: "PHY_B_08", name: "Units and Dimensions", priority: 'B' }, { id: "PHY_D_04", name: "Mathematics in Physics", priority: 'D' }, { id: "PHY_D_08", name: "Experimental Physics", priority: 'D' } ]}
                    ]
                },
                { 
                    subject: "Chemistry",
                    units: [
                        { unitName: "Physical Chemistry I", chapters: [ { id: "CHE_C_01", name: "Mole Concept", priority: 'C' }, { id: "CHE_B_01", name: "Structure of Atom", priority: 'B' }, { id: "CHE_A_03", name: "Chemical Bonding", priority: 'A' }, { id: "CHE_A_05", name: "Thermodynamics", priority: 'A' }, { id: "CHE_D_05", name: "Chemical Equilibrium", priority: 'D' }, { id: "CHE_D_03", name: "Ionic Equilibrium", priority: 'D' } ]},
                        { unitName: "Physical Chemistry II", chapters: [ { id: "CHE_B_02", name: "Solutions", priority: 'B' }, { id: "CHE_D_04", name: "Redox Reactions", priority: 'D' }, { id: "CHE_A_06", name: "Electrochemistry", priority: 'A' }, { id: "CHE_B_06", name: "Chemical Kinetics", priority: 'B' } ]},
                        { unitName: "Inorganic Chemistry", chapters: [ { id: "CHE_C_03", name: "Periodic Table", priority: 'C' }, { id: "CHE_B_05", name: "p Block Elements", priority: 'B' }, { id: "CHE_A_04", name: "d and f Block Elements", priority: 'A' }, { id: "CHE_A_02", name: "Coordination Compounds", priority: 'A' } ]},
                        { unitName: "Organic Chemistry I", chapters: [ { id: "CHE_A_01", name: "General Organic Chemistry", priority: 'A' }, { id: "CHE_B_03", name: "Hydrocarbons", priority: 'B' }, { id: "CHE_C_04", name: "Haloalkanes and Haloarenes", priority: 'C' } ]},
                        { unitName: "Organic Chemistry II", chapters: [ { id: "CHE_C_05", name: "Alcohols Phenols and Ethers", priority: 'C' }, { id: "CHE_C_02", name: "Aldehydes and Ketones", priority: 'C' }, { id: "CHE_D_02", name: "Carboxylic Acid Derivatives", priority: 'D' }, { id: "CHE_B_04", name: "Amines", priority: 'B' } ]},
                        { unitName: "Applied Chemistry", chapters: [ { id: "CHE_B_07", name: "Biomolecules", priority: 'B' }, { id: "CHE_D_01", name: "Practical Chemistry", priority: 'D' } ]}
                    ]
                },
                { 
                    subject: "Mathematics",
                    units: [
                        { unitName: "Algebra", chapters: [ { id: "MAT_B_07", name: "Sets and Relations", priority: 'B' }, { id: "MAT_B_08", name: "Quadratic Equation", priority: 'B' }, { id: "MAT_B_05", name: "Complex Number", priority: 'B' }, { id: "MAT_A_03", name: "Matrices Determinants", priority: 'A' }, { id: "MAT_B_02", name: "Permutation Combination", priority: 'B' }, { id: "MAT_A_07", name: "Binomial Theorem", priority: 'A' }, { id: "MAT_A_02", name: "Sequences and Series", priority: 'A' } ]},
                        { unitName: "Calculus", chapters: [ { id: "MAT_D_06", name: "Basic of Mathematics", priority: 'D' }, { id: "MAT_A_06", name: "Functions", priority: 'A' }, { id: "MAT_C_03", name: "Limits", priority: 'C' }, { id: "MAT_C_06", name: "Continuity and Differentiability", priority: 'C' }, { id: "MAT_D_04", name: "Differentiation", priority: 'D' }, { id: "MAT_B_06", name: "Application of Derivatives", priority: 'B' }, { id: "MAT_D_02", name: "Indefinite Integration", priority: 'D' }, { id: "MAT_A_05", name: "Definite Integration", priority: 'A' }, { id: "MAT_B_04", name: "Area Under Curves", priority: 'B' }, { id: "MAT_A_08", name: "Differential Equations", priority: 'A' } ]},
                        { unitName: "Coordinate Geometry & Vectors", chapters: [ { id: "MAT_B_03", name: "Straight Lines", priority: 'B' }, { id: "MAT_C_01", name: "Circle", priority: 'C' }, { id: "MAT_C_04", name: "Parabola", priority: 'C' }, { id: "MAT_C_07", name: "Ellipse", priority: 'C' }, { id: "MAT_C_05", name: "Hyperbola", priority: 'C' }, { id: "MAT_A_01", name: "Three-Dimensional Geometry", priority: 'A' }, { id: "MAT_A_04", name: "Vector Algebra", priority: 'A' } ]},
                        { unitName: "Trigonometry", chapters: [ { id: "MAT_D_05", name: "Trigonometric Ratios & Identities", priority: 'D' }, { id: "MAT_D_03", name: "Trigonometric Equations", priority: 'D' }, { id: "MAT_D_01", name: "Inverse Trigonometric Functions", priority: 'D' } ]},
                        { unitName: "Statistics & Probability", chapters: [ { id: "MAT_C_02", name: "Statistics", priority: 'C' }, { id: "MAT_B_01", name: "Probability", priority: 'B' } ]}
                    ]
                }
            ];

            // --- STATE MANAGEMENT ---
            let appState = {
                statuses: JSON.parse(localStorage.getItem(STORAGE_KEY)) || {},
                groupByPriority: localStorage.getItem(VIEW_KEY) === 'flat' ? false : true,
                searchTerm: '',
                openChapters: null,
                openGroups: null,
                expandedSubjects: new Set(),
                expandedGroups: new Set(),
                statsInitTime: parseInt(localStorage.getItem(STATS_INIT_KEY) || Date.now()),
                statsStartCount: 0,
                isVelocityVisible: localStorage.getItem(VELOCITY_STATE_KEY) === 'true'
            };

            // Set init time if not present
            if (!localStorage.getItem(STATS_INIT_KEY)) {
                localStorage.setItem(STATS_INIT_KEY, appState.statsInitTime);
            }

            // Load View State
            const loadViewState = () => {
                const saved = localStorage.getItem(VIEW_STATE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        appState.expandedSubjects = new Set(parsed.subjects || []);
                        appState.expandedGroups = new Set(parsed.groups || []);
                    } catch (e) {
                        console.error('Failed to load view state', e);
                    }
                }
            };
            loadViewState();

            const saveViewState = () => {
                localStorage.setItem(VIEW_STATE_KEY, JSON.stringify({
                    subjects: Array.from(appState.expandedSubjects),
                    groups: Array.from(appState.expandedGroups)
                }));
            };

            // --- DATA MIGRATION ---
            if (Object.keys(appState.statuses).length === 0) {
                const oldData = localStorage.getItem(OLD_STORAGE_KEY);
                if (oldData) {
                    try {
                        const parsedOldData = JSON.parse(oldData);
                        if (parsedOldData && Object.keys(parsedOldData).length > 0) {
                            appState.statuses = parsedOldData;
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(appState.statuses));
                            console.log("Migrated data from v2 to v3");
                        }
                    } catch (e) {
                        console.error("Migration failed", e);
                    }
                }
            }

            // --- DOM ELEMENTS ---
            const els = {
                syllabusContainer: document.getElementById('syllabus-container'),
                overallStats: document.getElementById('overall-progress-data'),
                search: document.getElementById('syllabus-search'),
                filterPriority: document.getElementById('filter-priority'),
                filterFlat: document.getElementById('filter-flat'),
                toggleContainer: document.querySelector('.view-toggle'),
                shareModal: document.getElementById('share-modal'),
                shareModalContent: document.getElementById('share-modal-content'),
                resetModal: document.getElementById('reset-modal'),
                // FAB
                fabBtn: document.getElementById('fab-btn'),
                fabMenu: document.getElementById('fab-menu'),
                // Velocity
                velocityContainer: document.getElementById('velocity-container'),
                velocityToggleBtn: document.getElementById('velocity-toggle-btn'),
                velocityContent: document.getElementById('velocity-content'),
                velocityChevron: document.getElementById('velocity-chevron'),
                velChaptersLeft: document.getElementById('vel-chapters-left'),
                velPace: document.getElementById('vel-pace'),
                velEndDate: document.getElementById('vel-end-date'),
                velSubtext: document.getElementById('vel-subtext')
            };

            // --- UTILITIES ---
            const saveState = () => {
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(appState.statuses));
                } catch(e) {
                    console.error("Storage full or unavailable");
                }
            };

            // Helper to escape regex characters to prevent crashes
            const escapeRegExp = (string) => {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            };

            const calculateStats = (chapters) => {
                if (!chapters.length) return { percent: 0, counts: { mastered: 0, completed: 0, inProgress: 0, notStarted: 0 } };
                
                let weightSum = 0;
                let counts = { mastered: 0, completed: 0, inProgress: 0, notStarted: 0 };
                
                chapters.forEach(ch => {
                    const status = appState.statuses[ch.id] || 'not-started';
                    weightSum += STATUS_CONFIG[status].weight;
                    
                    if(status === 'mastered') counts.mastered++;
                    else if(status === 'completed') counts.completed++;
                    else if(status === 'in-progress') counts.inProgress++;
                    else counts.notStarted++;
                });

                return {
                    percent: Math.round((weightSum / chapters.length) * 100),
                    counts
                };
            };

            const showToast = (msg) => {
                const toast = document.createElement('div');
                toast.className = 'toast glass-panel';
                toast.innerHTML = `<span class="text-indigo-400">âœ“</span> ${msg}`;
                document.body.appendChild(toast);
                
                requestAnimationFrame(() => toast.classList.add('show'));
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 500);
                }, 3000);
            };

            // --- RENDERING ---
            const getStatusBadge = (status, isButton = false) => {
                const conf = STATUS_CONFIG[status];
                return `
                    <div class="flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-semibold tracking-wide transition-all border ${conf.bg} ${conf.color} ${conf.border} ${isButton ? 'hover:brightness-110 cursor-pointer' : ''}">
                        <div class="w-1.5 h-1.5 rounded-full ${conf.dot}"></div>
                        ${conf.label}
                    </div>
                `;
            };

            const renderInlineMenu = (targetId, isGroup) => {
                const currentStatus = isGroup ? null : (appState.statuses[targetId] || 'not-started');
                
                let html = `<div class="status-menu-wrapper" id="menu-${targetId}">
                    <div class="overflow-hidden">
                        <div class="bg-zinc-900/90 border border-zinc-800 rounded-lg p-1.5 shadow-xl grid grid-cols-1 gap-1">`;
                
                if (isGroup) {
                    html += `<div class="px-2 py-1 text-[10px] uppercase font-bold text-zinc-500 tracking-wider">Set all to:</div>`;
                }

                Object.keys(STATUS_CONFIG).forEach(key => {
                    const conf = STATUS_CONFIG[key];
                    const isActive = key === currentStatus;
                    html += `
                        <button class="menu-option w-full text-left px-3 py-2.5 rounded-md flex items-center gap-3 transition-colors ${isActive ? 'bg-zinc-800' : 'hover:bg-zinc-800'}" 
                                data-status="${key}" data-target="${targetId}" data-is-group="${isGroup}">
                            <div class="w-2 h-2 rounded-full ${conf.dot}"></div>
                            <span class="text-sm font-medium ${isActive ? 'text-white' : 'text-zinc-400'}">${conf.label}</span>
                            ${isActive ? '<svg class="ml-auto w-4 h-4 text-indigo-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
                        </button>
                    `;
                });

                html += `</div></div></div>`;
                return html;
            };

            const renderChapter = (chapter, highlightRegex) => {
                const status = appState.statuses[chapter.id] || 'not-started';
                const nameHtml = highlightRegex ? chapter.name.replace(highlightRegex, match => `<span class="highlight">${match}</span>`) : chapter.name;

                return `
                    <div class="chapter-item group" data-id="${chapter.id}">
                        <div class="flex items-center justify-between py-3 px-3 rounded-lg hover:bg-zinc-800/50 transition-colors cursor-pointer border border-transparent hover:border-zinc-800 chapter-trigger active:scale-[0.99]">
                            <span class="text-[0.9rem] font-medium text-zinc-300 group-hover:text-zinc-100 transition-colors mr-4">${nameHtml}</span>
                            ${getStatusBadge(status, true)}
                        </div>
                        ${renderInlineMenu(chapter.id, false)}
                    </div>
                `;
            };

            const renderGroup = (group, subject) => {
                const stats = calculateStats(group.chapters);
                const uniqueId = `${subject}-${group.groupName.replace(/\s+/g, '-')}`;
                // Create regex safely
                const highlightRegex = appState.searchTerm ? new RegExp(`(${escapeRegExp(appState.searchTerm)})`, 'gi') : null;
                
                // Filter logic
                let visibleChapters = group.chapters;
                if (highlightRegex) {
                    const groupMatch = highlightRegex.test(group.groupName);
                    if (!groupMatch) {
                        visibleChapters = group.chapters.filter(ch => highlightRegex.test(ch.name));
                    }
                }
                
                if (visibleChapters.length === 0 && appState.searchTerm) return '';

                const groupNameHtml = highlightRegex ? group.groupName.replace(highlightRegex, match => `<span class="highlight">${match}</span>`) : group.groupName;
                const isExpanded = appState.expandedGroups.has(uniqueId) || !!appState.searchTerm;

                // BUG FIX: Store all chapter IDs in data attribute for "Set All" functionality
                // This ensures "Set All" works even if chapters are filtered out visually
                const allChapterIds = group.chapters.map(c => c.id).join(',');

                return `
                    <div class="group-branch border border-zinc-800 rounded-xl overflow-hidden mb-3 bg-zinc-900/30 ${isExpanded ? 'expanded' : ''}" data-unique-id="${uniqueId}" data-all-chapters="${allChapterIds}">
                        <div class="p-3.5 flex items-center justify-between bg-zinc-900/50 hover:bg-zinc-900 transition-colors group cursor-pointer group-toggle">
                            <button class="flex items-center gap-3 flex-1 text-left focus:outline-none w-full h-full">
                                <svg class="w-4 h-4 text-zinc-500 arrow-icon transform transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                                <span class="text-sm font-bold text-zinc-200">${groupNameHtml}</span>
                            </button>
                            <div class="relative">
                                <button class="text-xs font-bold px-2 py-1 rounded bg-zinc-800 text-zinc-400 hover:text-white hover:bg-indigo-600 hover:shadow-[0_0_10px_rgba(99,102,241,0.5)] transition-all group-menu-trigger" data-id="${uniqueId}">
                                    ${stats.percent}%
                                </button>
                            </div>
                        </div>
                        
                        <div id="group-menu-container-${uniqueId}">
                            ${renderInlineMenu(uniqueId, true)}
                        </div>

                        <div class="accordion-wrapper ${isExpanded ? 'open' : ''}">
                            <div class="accordion-inner p-3 space-y-1">
                                ${visibleChapters.map(ch => renderChapter(ch, highlightRegex)).join('')}
                            </div>
                        </div>
                    </div>
                `;
            };

            const renderSubject = (subjectData) => {
                const allChapters = subjectData.units.flatMap(u => u.chapters);
                const stats = calculateStats(allChapters);
                const highlightRegex = appState.searchTerm ? new RegExp(`(${escapeRegExp(appState.searchTerm)})`, 'gi') : null;
                
                let groups = [];
                if (appState.groupByPriority) {
                    const map = { A: [], B: [], C: [], D: [] };
                    allChapters.forEach(ch => map[ch.priority].push(ch));
                    ['A', 'B', 'C', 'D'].forEach(p => {
                        if(map[p].length) groups.push({ groupName: `Priority ${p}`, chapters: map[p] });
                    });
                } else {
                    groups = subjectData.units.map(u => ({ groupName: u.unitName, chapters: u.chapters }));
                }

                // Render groups strings
                const groupsHtml = groups.map(g => renderGroup(g, subjectData.subject)).join('');
                
                // If search active and no groups visible, hide subject
                if (groupsHtml === '' && appState.searchTerm && !highlightRegex.test(subjectData.subject)) return '';

                const isExpanded = appState.expandedSubjects.has(subjectData.subject) || !!appState.searchTerm;

                // Color calculation for segments
                const total = allChapters.length;
                const masteredVal = stats.counts.mastered;
                const completedVal = stats.counts.completed;
                const inProgressVal = stats.counts.inProgress;
                
                const c = 126; // Circumference (2 * PI * 20 â‰ˆ 125.66)

                // 1. Bottom Ring (Amber) - Represents InProgress + Completed + Mastered
                const p1 = total > 0 ? ((masteredVal + completedVal + inProgressVal) / total) : 0;
                const offset1 = c - (c * p1);

                // 2. Middle Ring (Emerald) - Represents Completed + Mastered
                const p2 = total > 0 ? ((masteredVal + completedVal) / total) : 0;
                const offset2 = c - (c * p2);

                // 3. Top Ring (Indigo) - Represents Mastered
                const p3 = total > 0 ? (masteredVal / total) : 0;
                const offset3 = c - (c * p3);

                return `
                    <div class="subject-card glass-card rounded-2xl overflow-hidden mb-4 h-fit ${isExpanded ? 'expanded' : ''}" data-subject="${subjectData.subject}">
                        <div class="p-5 flex items-center justify-between cursor-pointer subject-header hover:bg-white/5 transition-colors">
                            <div>
                                <h2 class="text-xl font-bold text-white tracking-tight">${subjectData.subject}</h2>
                                <div class="flex gap-3 text-xs font-medium text-zinc-500 mt-1">
                                    <span class="text-indigo-400">${stats.counts.mastered} Mastered</span>
                                    <span>â€¢</span>
                                    <span>${stats.percent}% Done</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="relative w-12 h-12">
                                    <svg class="w-full h-full transform -rotate-90">
                                        <circle cx="24" cy="24" r="20" stroke="#27272a" stroke-width="4" fill="none" />
                                        
                                        <circle cx="24" cy="24" r="20" class="text-amber-500" stroke="currentColor" stroke-width="4" fill="none" 
                                            stroke-dasharray="126" stroke-dashoffset="${offset1}" 
                                            stroke-linecap="round" />
                                            
                                        <circle cx="24" cy="24" r="20" class="text-emerald-500" stroke="currentColor" stroke-width="4" fill="none" 
                                            stroke-dasharray="126" stroke-dashoffset="${offset2}" 
                                            stroke-linecap="round" />
                                            
                                        <circle cx="24" cy="24" r="20" class="text-indigo-500" stroke="currentColor" stroke-width="4" fill="none" 
                                            stroke-dasharray="126" stroke-dashoffset="${offset3}" 
                                            stroke-linecap="round" />
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">
                                        ${stats.percent}%
                                    </div>
                                </div>
                                <svg class="w-5 h-5 text-zinc-600 arrow-icon transform transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </div>
                        </div>
                        <div class="accordion-wrapper ${isExpanded ? 'open' : ''}">
                            <div class="accordion-inner p-4 pt-0">
                                <div class="h-px bg-zinc-800 mb-4"></div>
                                ${groupsHtml}
                            </div>
                        </div>
                    </div>
                `;
            };

            const renderAll = () => {
                const html = SYLLABUS_DATA.map(renderSubject).join('');
                els.syllabusContainer.innerHTML = html || `<div class="col-span-2 text-center py-12 text-zinc-500">No chapters found for "${appState.searchTerm}"</div>`;
                
                attachDynamicEvents();
                updateOverallStats();
            };

            const updateOverallStats = () => {
                const allChapters = SYLLABUS_DATA.flatMap(s => s.units.flatMap(u => u.chapters));
                const stats = calculateStats(allChapters);
                
                els.overallStats.innerHTML = `
                    <div class="text-center mb-6">
                        <div class="text-5xl font-black text-white tracking-tighter mb-1">${stats.percent}%</div>
                        <div class="text-xs font-medium text-zinc-500 uppercase tracking-widest">Syllabus Covered</div>
                    </div>
                    
                    <div class="flex h-3 w-full rounded-full overflow-hidden bg-zinc-800">
                        <div class="bg-indigo-500 h-full transition-all duration-500 relative group" style="width: ${(stats.counts.mastered/allChapters.length)*100}%">
                             <div class="absolute inset-0 bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        </div>
                        <div class="bg-emerald-500 h-full transition-all duration-500" style="width: ${(stats.counts.completed/allChapters.length)*100}%"></div>
                        <div class="bg-amber-500 h-full transition-all duration-500" style="width: ${(stats.counts.inProgress/allChapters.length)*100}%"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <div class="p-3 rounded-lg bg-zinc-900/50 border border-zinc-800 flex items-center justify-between">
                            <div class="flex items-center gap-2 text-xs text-zinc-400"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>Mastered</div>
                            <span class="font-bold text-white text-sm">${stats.counts.mastered}</span>
                        </div>
                        <div class="p-3 rounded-lg bg-zinc-900/50 border border-zinc-800 flex items-center justify-between">
                            <div class="flex items-center gap-2 text-xs text-zinc-400"><div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>Completed</div>
                            <span class="font-bold text-white text-sm">${stats.counts.completed}</span>
                        </div>
                        <div class="p-3 rounded-lg bg-zinc-900/50 border border-zinc-800 flex items-center justify-between">
                            <div class="flex items-center gap-2 text-xs text-zinc-400"><div class="w-1.5 h-1.5 rounded-full bg-amber-500"></div>In Progress</div>
                            <span class="font-bold text-white text-sm">${stats.counts.inProgress}</span>
                        </div>
                        <div class="p-3 rounded-lg bg-zinc-900/50 border border-zinc-800 flex items-center justify-between">
                            <div class="flex items-center gap-2 text-xs text-zinc-400"><div class="w-1.5 h-1.5 rounded-full bg-zinc-600"></div>Left</div>
                            <span class="font-bold text-white text-sm">${stats.counts.notStarted}</span>
                        </div>
                    </div>
                `;

                updateVelocityTracker(stats.counts);
            };

            // --- VELOCITY TRACKER LOGIC ---
            const toggleVelocityTracker = () => {
                appState.isVelocityVisible = !appState.isVelocityVisible;
                localStorage.setItem(VELOCITY_STATE_KEY, appState.isVelocityVisible);
                applyVelocityVisibility();
            };

            const applyVelocityVisibility = () => {
                if (appState.isVelocityVisible) {
                    els.velocityContent.classList.remove('collapsed');
                    els.velocityChevron.classList.remove('collapsed');
                } else {
                    els.velocityContent.classList.add('collapsed');
                    els.velocityChevron.classList.add('collapsed');
                }
            };

            const updateVelocityTracker = (currentCounts) => {
                const totalChapters = SYLLABUS_DATA.flatMap(s => s.units.flatMap(u => u.chapters)).length;
                const doneCount = currentCounts.mastered + currentCounts.completed;
                const remaining = totalChapters - doneCount;
                
                els.velocityContainer.classList.remove('hidden');
                els.velChaptersLeft.textContent = remaining;

                applyVelocityVisibility();

                const now = Date.now();
                const msPerDay = 1000 * 60 * 60 * 24;
                const daysElapsed = (now - appState.statsInitTime) / msPerDay;
                
                let startDone = parseInt(localStorage.getItem('jeeSyllabusStartCount_v3'));
                if (isNaN(startDone)) {
                    startDone = doneCount;
                    localStorage.setItem('jeeSyllabusStartCount_v3', startDone);
                }

                if (daysElapsed < 1) {
                    els.velPace.textContent = "-- ch/day";
                    els.velEndDate.textContent = "Insufficient Data";
                    els.velSubtext.textContent = "Check back in 24h";
                    return;
                }

                const chaptersCompletedSinceStart = doneCount - startDone;
                
                if (chaptersCompletedSinceStart < 0) {
                    localStorage.setItem('jeeSyllabusStartCount_v3', doneCount);
                    localStorage.setItem(STATS_INIT_KEY, Date.now());
                    return;
                }

                const velocityPerDay = chaptersCompletedSinceStart / daysElapsed;

                // BUG FIX: Handle stalled or 0 velocity to prevent infinity dates
                if (velocityPerDay <= 0.001) {
                    els.velPace.textContent = "0 ch/day";
                    els.velEndDate.textContent = "Stalled";
                    els.velSubtext.textContent = "Complete chapters to see est.";
                } else {
                    const daysRemaining = remaining / velocityPerDay;
                    // Check if daysRemaining is finite
                    if (!isFinite(daysRemaining)) {
                         els.velEndDate.textContent = "N/A";
                         return;
                    }
                    const endDate = new Date(now + (daysRemaining * msPerDay));
                    
                    els.velPace.textContent = `${velocityPerDay.toFixed(2)} ch/day`;
                    els.velEndDate.textContent = endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    els.velSubtext.textContent = `Based on last ${Math.round(daysElapsed)} days`;
                }
            };

            // --- INTERACTION LOGIC ---

            const closeAllMenus = () => {
                document.querySelectorAll('.status-menu-wrapper.open').forEach(el => el.classList.remove('open'));
            };

            const toggleFabMenu = (e) => {
                e.stopPropagation();
                if (els.fabMenu.classList.contains('invisible')) {
                    els.fabMenu.classList.remove('invisible', 'opacity-0', 'scale-95');
                } else {
                    closeFabMenu();
                }
            };

            const closeFabMenu = () => {
                els.fabMenu.classList.add('invisible', 'opacity-0', 'scale-95');
            };

            const attachDynamicEvents = () => {
                document.querySelectorAll('.subject-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const card = header.parentElement;
                        const subjectName = card.dataset.subject;
                        const wrapper = card.querySelector('.accordion-wrapper');
                        
                        card.classList.toggle('expanded');
                        wrapper.classList.toggle('open');

                        if (card.classList.contains('expanded')) {
                            appState.expandedSubjects.add(subjectName);
                        } else {
                            appState.expandedSubjects.delete(subjectName);
                        }
                        saveViewState();
                    });
                });

                document.querySelectorAll('.group-toggle').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const groupEl = btn.closest('.group-branch');
                        const uniqueId = groupEl.dataset.uniqueId;
                        const wrapper = groupEl.querySelector('.accordion-wrapper');
                        
                        groupEl.classList.toggle('expanded');
                        wrapper.classList.toggle('open');

                        if (groupEl.classList.contains('expanded')) {
                            appState.expandedGroups.add(uniqueId);
                        } else {
                            appState.expandedGroups.delete(uniqueId);
                        }
                        saveViewState();
                    });
                });

                document.querySelectorAll('.chapter-trigger').forEach(trigger => {
                    trigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const chapterItem = trigger.closest('.chapter-item');
                        const menu = chapterItem.querySelector('.status-menu-wrapper');
                        
                        if (!menu.classList.contains('open')) {
                            closeAllMenus();
                            menu.classList.add('open');
                        } else {
                            menu.classList.remove('open');
                        }
                    });
                });

                document.querySelectorAll('.group-menu-trigger').forEach(trigger => {
                    trigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = trigger.dataset.id;
                        const menu = document.querySelector(`#group-menu-container-${id} .status-menu-wrapper`);
                        
                        if (!menu.classList.contains('open')) {
                            closeAllMenus();
                            menu.classList.add('open');
                        } else {
                            menu.classList.remove('open');
                        }
                    });
                });

                document.querySelectorAll('.menu-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const status = btn.dataset.status;
                        const target = btn.dataset.target;
                        const isGroup = btn.dataset.isGroup === 'true';

                        if (isGroup) {
                            // BUG FIX: Use data attribute to get ALL IDs in this group, not just visible ones
                            const groupEl = btn.closest('.group-branch');
                            const idsStr = groupEl.dataset.allChapters;
                            
                            if (idsStr) {
                                const ids = idsStr.split(',');
                                ids.forEach(id => appState.statuses[id] = status);
                                showToast(`Updated ${ids.length} chapters`);
                            }
                        } else {
                            appState.statuses[target] = status;
                        }

                        saveState();
                        renderAll();
                        closeAllMenus(); // Close menus after selection
                    });
                });
            };

            // --- EVENT LISTENERS (STATIC) ---
            
            els.toggleContainer.addEventListener('click', (e) => {
                const clicked = e.target.closest('[data-filter]');
                if (!clicked) return;
                
                const mode = clicked.dataset.filter;
                els.toggleContainer.dataset.mode = mode;
                appState.groupByPriority = (mode === 'priority');
                localStorage.setItem(VIEW_KEY, mode);
                
                if(appState.groupByPriority) {
                    els.filterPriority.classList.replace('text-zinc-500', 'text-white');
                    els.filterFlat.classList.replace('text-white', 'text-zinc-500');
                } else {
                    els.filterFlat.classList.replace('text-zinc-500', 'text-white');
                    els.filterPriority.classList.replace('text-white', 'text-zinc-500');
                }
                
                renderAll();
            });

            if (els.velocityToggleBtn) {
                els.velocityToggleBtn.addEventListener('click', toggleVelocityTracker);
            }

            els.search.addEventListener('input', (e) => {
                appState.searchTerm = e.target.value.trim();
                renderAll();
                
                if (appState.searchTerm) {
                    document.querySelectorAll('.accordion-wrapper').forEach(el => el.classList.add('open'));
                    document.querySelectorAll('.subject-card').forEach(el => el.classList.add('expanded'));
                }
            });

            els.fabBtn.addEventListener('click', toggleFabMenu);

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.status-menu-wrapper') && !e.target.closest('.chapter-trigger') && !e.target.closest('.group-menu-trigger')) {
                    closeAllMenus();
                }
                if (!e.target.closest('#fab-menu') && !e.target.closest('#fab-btn')) {
                    closeFabMenu();
                }
            });

            const banner = document.getElementById('zenith-banner');
            if (!localStorage.getItem(BANNER_KEY)) {
                setTimeout(() => banner.classList.add('show'), 500);
            }
            document.getElementById('close-banner-btn').addEventListener('click', () => {
                banner.classList.remove('show');
                localStorage.setItem(BANNER_KEY, 'true');
            });

            document.getElementById('reset-data-btn').addEventListener('click', () => {
                els.resetModal.classList.remove('hidden');
                requestAnimationFrame(() => els.resetModal.classList.remove('opacity-0'));
            });
            document.getElementById('cancel-reset-btn').addEventListener('click', () => {
                els.resetModal.classList.add('opacity-0');
                setTimeout(() => els.resetModal.classList.add('hidden'), 300);
            });
            document.getElementById('confirm-reset-btn').addEventListener('click', () => {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(STATS_INIT_KEY);
                localStorage.removeItem('jeeSyllabusStartCount_v3');
                
                appState.statuses = {};
                saveState();
                renderAll();
                
                els.resetModal.classList.add('opacity-0');
                setTimeout(() => els.resetModal.classList.add('hidden'), 300);
                showToast('All progress reset.');
                
                localStorage.setItem(STATS_INIT_KEY, Date.now());
                appState.statsInitTime = Date.now();
            });

            const updateShareCard = () => {
                const allChapters = SYLLABUS_DATA.flatMap(s => s.units.flatMap(u => u.chapters));
                const overallStats = calculateStats(allChapters);
                
                document.getElementById('share-card-overall-percent').textContent = `${overallStats.percent}%`;
                
                const rPhys = 75; const cPhys = 2 * Math.PI * rPhys;
                const rChem = 60; const cChem = 2 * Math.PI * rChem;
                const rMath = 45; const cMath = 2 * Math.PI * rMath;

                const physData = SYLLABUS_DATA.find(s => s.subject === 'Physics');
                const physStats = calculateStats(physData.units.flatMap(u => u.chapters));
                
                const chemData = SYLLABUS_DATA.find(s => s.subject === 'Chemistry');
                const chemStats = calculateStats(chemData.units.flatMap(u => u.chapters));
                
                const mathData = SYLLABUS_DATA.find(s => s.subject === 'Mathematics');
                const mathStats = calculateStats(mathData.units.flatMap(u => u.chapters));

                const physRing = document.getElementById('share-ring-physics');
                physRing.style.strokeDasharray = cPhys;
                setTimeout(() => {
                    physRing.style.strokeDashoffset = cPhys - (cPhys * physStats.percent / 100);
                }, 100);

                const chemRing = document.getElementById('share-ring-chemistry');
                chemRing.style.strokeDasharray = cChem;
                setTimeout(() => {
                    chemRing.style.strokeDashoffset = cChem - (cChem * chemStats.percent / 100);
                }, 200);

                const mathRing = document.getElementById('share-ring-maths');
                mathRing.style.strokeDasharray = cMath;
                setTimeout(() => {
                    mathRing.style.strokeDashoffset = cMath - (cMath * mathStats.percent / 100);
                }, 300);

                ['Physics', 'Chemistry', 'Mathematics'].forEach(sub => {
                    const subData = SYLLABUS_DATA.find(s => s.subject === sub);
                    const subChapters = subData.units.flatMap(u => u.chapters);
                    const subStats = calculateStats(subChapters);
                    
                    document.getElementById(`share-card-${sub.toLowerCase()}-percent`).textContent = `${subStats.percent}%`;
                    document.getElementById(`share-card-${sub.toLowerCase()}-bar`).style.width = `${subStats.percent}%`;
                });

                document.getElementById('share-card-date').textContent = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }).toUpperCase();
            };

            document.getElementById('share-progress-main-btn').addEventListener('click', () => {
                updateShareCard();
                els.shareModal.classList.remove('hidden');
                requestAnimationFrame(() => {
                    els.shareModal.classList.remove('opacity-0');
                    els.shareModalContent.classList.remove('scale-95', 'opacity-0');
                });
            });

            const closeShare = () => {
                els.shareModal.classList.add('opacity-0');
                els.shareModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => els.shareModal.classList.add('hidden'), 300);
            };

            document.getElementById('close-share-modal-btn').addEventListener('click', closeShare);
            document.getElementById('close-share-overlay').addEventListener('click', closeShare);

            if(!appState.groupByPriority) {
                els.toggleContainer.dataset.mode = 'flat';
                els.filterFlat.classList.replace('text-zinc-500', 'text-white');
                els.filterPriority.classList.replace('text-white', 'text-zinc-500');
            }
            applyVelocityVisibility();
            
            renderAll();
        });
    </script>
</body>
</html>